name: Build and Push Microservices and Frontend to Docker Hub

on:
  push:
    branches:
      - features/orderFiles  # Se ejecutar√° solo en esta rama

jobs:
  build-and-push:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Checkout del c√≥digo
        uses: actions/checkout@v3

      - name: üîë Login en Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: üõ†Ô∏è Construir y subir im√°genes de microservicios
        run: |
          # Listado de microservicios y sus rutas
          SERVICES=(
            "auth-user-service"
            "create-user-service"
            "get-user-service"
            "update-user-service"
            "delete-user-service"
            "get-all-users-service"
            "create-patient-service"
            "get-patient-service"
            "update-patient-service"
            "delete-patient-service"
            "get-patients-service"
            "create-doctor-service"
            "get-doctor-service"
            "update-doctor-service"
            "delete-doctor-service"
            "get-doctors-service"
            "create-appointment-service"
            "get-appointment-service"
            "update-appointment-service"
            "delete-appointment-service"
            "get-all-appointments-service"
            "create-medical-history-service"
            "get-medical-history"
            "update-medical-history-service"
            "delete-medical-history-service"
            "get-medical-history-by-name"
          )

          # Construir y subir cada microservicio
          for SERVICE in "${SERVICES[@]}"; do
            echo "üõ†Ô∏è Construyendo $SERVICE en BACKEND/services/$SERVICE"
            docker build -t ${{ secrets.DOCKER_USERNAME }}/$SERVICE:latest ./BACKEND/services/$SERVICE
            echo "‚¨ÜÔ∏è Subiendo $SERVICE a Docker Hub"
            docker push ${{ secrets.DOCKER_USERNAME }}/$SERVICE:latest
          done

      - name: üåê Construir y subir el frontend
        run: |
          echo "üöÄ Construyendo frontend en FRONTEND/"
          docker build -t ${{ secrets.DOCKER_USERNAME }}/frontend:latest ./FRONTEND
          echo "‚¨ÜÔ∏è Subiendo frontend a Docker Hub"
          docker push ${{ secrets.DOCKER_USERNAME }}/frontend:latest
